jQuery.extend(jQuery.easing, { easeInOutQuad: function (x, t, b, c, d) { if ((t /= d / 2) < 1) { return c / 2 * t * t + b } return -c / 2 * ((--t) * (t - 2) - 1) + b } }); $(function () {
    var flag = 0; var line1Data = [100, 102, 98, 90, 80, 82, 75, 70, 68, 65, 60, 65, 70, 68, 74, 96, 88, 65, 80, 105, 106, 75]; var line2Data = [121, 115, 117, 110, 102, 105, 109, 112, 110, 109, 100, 105, 110, 102, 108, 116, 120, 90, 113, 100, 101, 86]; var line3Data = [130, 135, 133, 140, 138, 145, 139, 140, 142, 144, 140, 135, 133, 130, 135, 144, 148, 130, 140, 135, 138, 130]; var xData = [-555, -511, -467, -423, -379, -335, -291, -247, -203, -159, -115, -71, -27, 17, 61, 105, 149, 193, 237, 281, 325, 369]; var textValueData = ["4,787", "5,602", "0", "0", "979", "1,335", "0", "0", "0", "7,773", "72", "74", "(17)", "(9)", "15,702", "243", "95", "0", "0", "0", "1,097", "0"]; var silderArr = [187, 232, 277, 322, 365, 409, 452, 496]; var line = d3.svg.line().x(function (d, i) { return xData[i] }).y(function (d, i) { return d }); d3.select("#hidePath1").datum(line1Data).attr("d", line); d3.select("#hidePath2").datum(line2Data).attr("d", line); d3.select("#hidePath3").datum(line3Data).attr("d", line); d3.select("#shadow1").datum(line1Data).attr("d", line); d3.select("#shadow2").datum(line2Data).attr("d", line); d3.select("#shadow3").datum(line3Data).attr("d", line); d3.select("#path1").datum(line1Data).attr("d", line); d3.select("#path2").datum(line2Data).attr("d", line); d3.select("#path3").datum(line3Data).attr("d", line); var gPoints1 = d3.select("#points1").selectAll("g").data(line1Data).enter().append("g"); var points1 = gPoints1.data(line1Data).append("circle").attr("r", 5).attr("cy", function (d, i) { return d }); points1.data(xData).attr("cx", function (d, i) { return d }); var gPoints2 = d3.select("#points2").selectAll("g").data(line2Data).enter().append("g"); var points2 = gPoints2.data(line2Data).append("circle").attr("r", 5).attr("cy", function (d, i) { return d }); points2.data(xData).attr("cx", function (d, i) { return d }); var gPoints3 = d3.select("#points3").selectAll("g").data(line3Data).enter().append("g"); var points3 = gPoints3.data(line3Data).append("circle").attr("r", 5).attr("cy", function (d, i) { return d }); points3.data(xData).attr("cx", function (d, i) { return d }); var gShaPo1 = d3.select("#shadowPoint1").selectAll("g").data(line1Data).enter().append("g").attr("transform", "translate(0,4)"); var shapo1 = gShaPo1.data(line1Data).append("circle").attr("r", 5).attr("cy", function (d, i) { return d }); shapo1.data(xData).attr("cx", function (d, i) { return d }); var gShaPo2 = d3.select("#shadowPoint2").selectAll("g").data(line2Data).enter().append("g").attr("transform", "translate(0,4)"); var shapo2 = gShaPo2.data(line2Data).append("circle").attr("r", 5).attr("cy", function (d, i) { return d }); shapo2.data(xData).attr("cx", function (d, i) { return d }); var gShaPo3 = d3.select("#shadowPoint3").selectAll("g").data(line3Data).enter().append("g").attr("transform", "translate(0,4)"); var shapo3 = gShaPo3.data(line3Data).append("circle").attr("r", 5).attr("cy", function (d, i) { return d }); shapo3.data(xData).attr("cx", function (d, i) { return d }); var rects1 = gPoints1.data(line1Data).append("rect").attr("y", function (d, i) { return d - 22 }).attr("fill", "white").attr("stroke", "#68217a").attr("display", "none"); rects1.data(xData).attr("x", function (d) { return d - 18 }).attr("width", 38).attr("height", 15).attr("rx", 8).attr("ry", 8); var texts1 = gPoints1.data(line1Data).append("text").attr("y", function (d, i) { return d - 10 }).attr("font-size", "11").attr("fill", "black"); texts1.data(xData).attr("x", function (d, i) { return d }).attr("text-anchor", "middle").attr("display", "none"); texts1.data(textValueData).text(function (d, i) { return d }); var rects2 = gPoints2.data(line2Data).append("rect").attr("y", function (d, i) { return d - 22 }).attr("fill", "white").attr("stroke", "#ff8c00").attr("display", "none"); rects2.data(xData).attr("x", function (d) { return d - 18 }).attr("width", 38).attr("height", 15).attr("rx", 8).attr("ry", 8); var texts2 = gPoints2.data(line2Data).append("text").attr("y", function (d, i) { return d - 10 }).attr("font-size", "11").attr("fill", "black"); texts2.data(xData).attr("x", function (d, i) { return d }).attr("text-anchor", "middle").attr("display", "none"); texts2.data(textValueData).text(function (d, i) { return d }); var rects3 = gPoints3.data(line3Data).append("rect").attr("y", function (d, i) { return d - 22 }).attr("fill", "white").attr("stroke", "#7fba00").attr("display", "none"); rects3.data(xData).attr("x", function (d) { return d - 18 }).attr("width", 38).attr("height", 15).attr("rx", 8).attr("ry", 8); var texts3 = gPoints3.data(line3Data).append("text").attr("y", function (d, i) { return d - 10 }).attr("font-size", "11").attr("fill", "black"); texts3.data(xData).attr("x", function (d, i) { return d }).attr("text-anchor", "middle").attr("display", "none"); texts3.data(textValueData).text(function (d, i) { return d }); var textHeadData = ["Q3-13", "Q3-13", "Q3-13", "Q3-13", "Q3-13", "Q3-13", "Q3-13", "Q3-13", "Q3-13", "Q3-13", "Q3-13", "Q3-13", "Q3-13", "Q3-13", "Q3-13", "Q3-13", "Q3-13", "Q2-14", "Q3-14", "Q4-14", "Q1-15", "Q2-15"]; var textHead = d3.select("#head").selectAll("text").data(textHeadData).enter().append("text").attr("y", 25).text(function (d, i) { return d }); textHead.data(xData).attr("x", function (d, i) { return d - 44 }); for (var i = 0; i < 25; i++) {
        var gTar = d3.select("#valueText").append("g");
        var targetText = gTar.selectAll("text").data(textValueData).enter().append("text").attr("y", (50 + (i * 20))).text(function (d, i) { return d }); targetText.data(xData).attr("x", function (d, i) { return d - 25 })
    } Response(); var minScale = getMinScale(); var delay = 1000; var count = 0; $(".path").find("path").each(function () { var totalLength = this.getTotalLength(); d3.select(this).attr("stroke-dashoffset", totalLength).attr("stroke-dasharray", totalLength + " " + totalLength).transition().duration(delay).ease("easeInOutQuad").attr("stroke-dashoffset", 0) }); d3.selectAll(".points").transition().duration(240).delay(delay).ease("linear").attr("display", "block").attr("transform", "translate(0,0)"); d3.selectAll(".shadowPoints").transition().duration(240).delay(delay).attr("display", "block"); var sliRect8 = d3.select("#svg2").select("#slider").select("#sliRect8"); var tarX = $("#sliRect8").position().left + 3; d3.select("#sliRect").transition().duration(500).delay(1300).attr("x", sliRect8.attr("x")); d3.select("#sliText").transition().duration(500).delay(1300).attr("x", parseFloat(sliRect8.attr("x")) + 22); d3.select("#glass").transition().duration(500).delay(1300).style("left", tarX + "px"); d3.select("#svg1").selectAll(".checkbox").on("click", function () { var chk1Color = d3.select(this).select(".chk1").attr("fill"); var chk2Color = d3.select(this).select(".chk2").attr("fill"); var gLine = null; d3.select("#svg2").selectAll(".line").each(function () { var pathColor = d3.select(this).select(".path").select("path").attr("stroke"); if (pathColor == chk1Color) { gLine = d3.select(this) } }); if (chk2Color == "white") { d3.select(this).select(".chk2").attr("fill", chk1Color); gLine.attr("display", "none") } else { d3.select(this).select(".chk2").attr("fill", "white"); gLine.attr("display", "block") } }); d3.select("#svg1").selectAll(".checkbox").on("mouseover", function () { d3.select(this).select(".chkHover").attr("display", "block"); d3.select("#svg2").select(".leftHover").attr("display", "block"); var chk1Color = d3.select(this).select(".chk1").attr("fill"); var chk2Color = d3.select(this).select(".chk2").attr("fill"); var gLine = null; d3.select("#svg2").selectAll(".line").each(function () { var pathColor = d3.select(this).select(".path").select("path").attr("stroke"); if (pathColor == chk1Color) { gLine = d3.select(this) } }); if (chk2Color == "white") { gLine.select(".path").select("path").transition().duration(10).attr("transform", "translate(0,-6)"); gLine.select(".path").select(".shadow").transition().duration(10).attr("transform", "translate(0,6)"); gLine.select(".points").selectAll("g").transition().duration(10).attr("transform", "translate(0,-6)"); gLine.select(".shadowPoints").selectAll("g").transition().duration(10).attr("transform", "translate(0,6)") } }).on("mouseout", function () { d3.select(this).select(".chkHover").attr("display", "none"); d3.select("#svg2").select(".leftHover").attr("display", "none"); var chk1Color = d3.select(this).select(".chk1").attr("fill"); var chk2Color = d3.select(this).select(".chk2").attr("fill"); var gLine = null; d3.select("#svg2").selectAll(".line").each(function () { var pathColor = d3.select(this).select(".path").select("path").attr("stroke"); if (pathColor == chk1Color) { gLine = d3.select(this) } }); if (chk2Color == "white") { gLine.select(".path").select("path").transition().duration(100).attr("transform", "translate(0,0)"); gLine.select(".path").select(".shadow").transition().duration(100).attr("transform", "translate(0,4)"); gLine.select(".points").selectAll("g").transition().duration(100).attr("transform", "translate(0,0)"); gLine.select(".shadowPoints").selectAll("g").transition().duration(10).attr("transform", "translate(0,4)") } }); var timer = null; $("#leftSlider").mousedown(function () { timer = setInterval(function () { tick(1) }, 180) }).mouseup(function () { tick(1); clearInterval(timer) }); $("#rightSlider").mousedown(function () { timer = setInterval(function () { tick(-1) }, 180) }).mouseup(function () { tick(-1); clearInterval(timer) }); d3.select("#svg2").select("#slider").select("#sliRects").selectAll("rect").on("click", function () { var tarRect = d3.select(this); var posiX = $(this).position().left + 3; d3.select("#sliRect").transition().duration(200).attr("x", tarRect.attr("x")); d3.select("#sliText").transition().duration(200).attr("x", parseFloat(tarRect.attr("x")) + 22); d3.select("#glass").transition().duration(200).style("left", posiX + "px") }); var dragFlag = false; $("#sliRect").mousedown(function (e) { dragFlag = true }).mouseup(function () { dragFlag = false }); d3.select("#sliRects").selectAll("rect").on("mousemove", function () { if (dragFlag) { var tarRect = d3.select(this); var posiX = $(this).position().left + 3; d3.select("#sliRect").transition().duration(300).ease("easeInOutQuad").attr("x", tarRect.attr("x")); d3.select("#sliText").transition().duration(300).ease("easeInOutQuad").attr("x", parseFloat(tarRect.attr("x")) + 22); d3.select("#glass").transition().duration(300).ease("easeInOutQuad").style("left", posiX + "px") } }).on("mouseup", function () { dragFlag = false }); d3.select("body").on("mouseup", function () { dragFlag = false }); d3.select("#svg2").selectAll(".points").selectAll("g").on("mouseover", function () {
        var tarPoint = d3.select(this).select("circle");
        tarPoint.attr("r", parseInt(tarPoint.attr("r")) + 2); d3.select(this).select("text").attr("display", "block"); d3.select(this).select("rect").attr("display", "block")
    }).on("mouseout", function () { var tarPoint = d3.select(this).select("circle"); tarPoint.attr("r", parseInt(tarPoint.attr("r")) - 2); d3.select(this).select("text").attr("display", "none"); d3.select(this).select("rect").attr("display", "none") }); d3.selectAll(".line").on("mouseover", function (d) { d3.select(this).select(".path").select("path").transition().duration(10).attr("transform", "translate(0,-6)"); d3.select(this).select(".path").select(".shadow").transition().duration(10).attr("transform", "translate(0,6)"); d3.select(this).select(".points").selectAll("g").transition().duration(10).attr("transform", "translate(0,-6)"); d3.select(this).select(".shadowPoints").selectAll("g").transition().duration(10).attr("transform", "translate(0,6)"); d3.select("#svg2").select(".rightHover").attr("display", "block") }).on("mouseout", function () { d3.select(this).select(".path").select("path").transition().duration(100).attr("transform", "translate(0,0)"); d3.select(this).select(".path").select(".shadow").transition().duration(100).attr("transform", "translate(0,4)"); d3.select(this).select(".points").selectAll("g").transition().duration(100).attr("transform", "translate(0,0)"); d3.select(this).select(".shadowPoints").selectAll("g").transition().duration(10).attr("transform", "translate(0,4)"); d3.select("#svg2").select(".rightHover").attr("display", "none") }); function tick(type) { var limit = xData.length - 8; if (type == -1) { if (flag > 0) { d3.selectAll(".path").attr("transform", "translate(" + (flag * 44) + ",0)").transition().duration(100).ease("linear").attr("transform", "translate(" + (flag - 1) * 44 + ",0)"); d3.selectAll(".points").attr("transform", "translate(" + (flag * 44) + ",0)").transition().duration(100).ease("linear").attr("transform", "translate(" + (flag - 1) * 44 + ",0)"); d3.selectAll(".shadowPoints").attr("transform", "translate(" + (flag * 44) + ",0)").transition().duration(100).ease("linear").attr("transform", "translate(" + (flag - 1) * 44 + ",0)"); d3.select("#svg4").selectAll("text").attr("transform", "translate(" + (flag * 44) + ",0)").transition().duration(100).ease("linear").attr("transform", "translate(" + (flag - 1) * 44 + ",0)"); flag = flag - 1 } } else { if (flag < limit) { d3.selectAll(".path").attr("transform", "translate(" + (flag * 44) + ",0)").transition().duration(100).ease("linear").attr("transform", "translate(" + (flag + 1) * 44 + ",0)"); d3.selectAll(".points").attr("transform", "translate(" + (flag * 44) + ",0)").transition().duration(100).ease("linear").attr("transform", "translate(" + (flag + 1) * 44 + ",0)"); d3.selectAll(".shadowPoints").attr("transform", "translate(" + (flag * 44) + ",0)").transition().duration(100).ease("linear").attr("transform", "translate(" + (flag + 1) * 44 + ",0)"); d3.select("#svg4").selectAll("text").attr("transform", "translate(" + (flag * 44) + ",0)").transition().duration(100).ease("linear").attr("transform", "translate(" + (flag + 1) * 44 + ",0)"); flag = flag + 1 } } }
}); window.onresize = function () { Response() }; var widthData = [{ width: 140, height: 230 }, { width: 430, height: 230 }, { width: 150, height: 660 }, { width: 360, height: 660 }]; function Response() { var minScale = getMinScale(); for (var i = 1; i < 5; i++) { d3.select("#svg" + i).attr("width", widthData[i - 1].width * minScale).attr("height", widthData[i - 1].height * minScale); d3.select("#svg" + i).select("g").attr("transform", "scale(" + minScale + ")") } var posi = $("#slider").find("#sliRect").position(); var sliderWidth = $("#slider").find("#sliRect").attr("width") * minScale; var sliderHeight = $("#slider").find("#sliRect").attr("height") * minScale; var glassHeight = 0; $(".cellRightDiv").each(function () { glassHeight += parseFloat($(this).css("height").replace("px", "")) }); $("#glass").css("top", posi.top + sliderHeight + 1).css("left", posi.left + 3).css("display", "block").css("width", sliderWidth - 6).css("height", (glassHeight - 50) + "px") } function getMinScale() { var minScale = 0; for (var i = 1; i < 5; i++) { var svgWidth = 0; if (i == 4) { svgWidth = $("#svg" + i).parent().width() * 0.83 } else { svgWidth = $("#svg" + i).parent().width() } var scale = svgWidth / widthData[i - 1].width; if (minScale == 0) { minScale = scale } else { if (minScale > scale) { minScale = scale } } } return minScale };